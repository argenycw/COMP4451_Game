<html>
<head>
	<meta charset=utf-8>
	<title>Three.js testing</title>
	<link rel="stylesheet" type="text/css" href="fonts/widget.css">
	<style>
		body { margin: 0; overflow: hidden; }
		canvas { width: 100%; height: 100%; }
		button { position: absolute; top: 0; left: 0;}
		svg { position:absolute; }
		.music-bar { position: absolute; top: 80%; left: 0%; width: 100%; height: 10%; }
		.unselectable {
			-webkit-touch-callout: none;
		    -webkit-user-select: none;
		    -khtml-user-select: none;
		    -moz-user-select: none;
		    -ms-user-select: none;
		    user-select: none;
		}
	</style>
	<script src="lib/three.js"></script>
	<script src="lib/GLTFLoader.js"></script>
	<script src="lib/RoundEdgedBox.js"></script>
	<script src="lib/MeshLine.js"></script>
	<script src="ResourceLoader.js"></script>
	<script src="Widget.js"></script>
	<script src="menu.js"></script>
	<script src="stage.js"></script>
	<script src="musicbar.js"></script>
	<script src="music.js"></script>
</head>
<body>
	<script>
		const DEBUG = true;
		const stageBeginMsg = ["3", "2", "1", "Stage Begin"];
		var resourceLoader = null;
		var widget = new Widget();
		initCanvas();
		mainMenu();
		// Listener for window resize
		window.addEventListener('resize', function() {
			renderer.setSize(window.innerWidth, window.innerHeight);
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
		}, false);

		function start(stage) {
			// Load resources using ResourceLoader
			let num = parseInt(stage);
			let mapName = "map" + ((num < 10) ? '0' + num : num) + ".json";
			let themeName = "theme0.json";
			let stageName = "stage" + ((num < 10) ? '0' + num : num) + ".json";
			stageLevel = num;
			resourceLoader = new ResourceLoader(mapName, themeName, stageName, mapFolder, themeFolder, noteFolder);
			resourceLoader.mapCallback = stageOnSuccessLoad;
			resourceLoader.themeCallback = themeOnSuccessLoad;
			resourceLoader.stageCallback = notesOnSuccessLoad;
			resourceLoader.load();
			widget.showLoadingScreen();
			waitUntilLoaded();
		}

		function waitUntilLoaded() {
			if (resourceLoader.loadCompleted()) {
				resourceLoader.runCallbacks();
				widget.clearLoadingScreen();
				// Pause/resume button
				widget.showDefinedSVG("96%", "2%", "#svg-pause", ["black-round-btn"], gamePauseToggle, "pause-resume");
				stageBegin();
			}
			else setTimeout(waitUntilLoaded, 200);
		}

	</script>
</body>
</html>
